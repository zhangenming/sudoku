<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
</html>
<script>
  console.clear()
  console.time()
  const A3 = [...Array(3).keys()]
  const A9 = [...Array(9).keys()]
  const A9from1 = [...A9].map(e => e + 1)

  const index2flex = A3.map(y =>
    A3.map(x => A3.map(l => A3.map(r => [l + y * 3, r + x * 3])))
  ).flat(3)

  function flex2index([squre, index]) {
    return index2flex.map(e => "" + e).findIndex(e => e === `${squre},${index}`)
  } //todo with MAP
  function hang2lie(row) {
    return A9.map(x => A9.map(y => row[y][x]))
  }
  function hang2area(hang) {
    const flat = hang.flat()
    return A9.map(squre =>
      A9.map(index => {
        const i = flex2index([squre, index])
        return flat[i]
      })
    )
  }
  function isValue(item) {
    return !Array.isArray(item.ItemMayBeValue)
  }
  function isMaybe(item) {
    return Array.isArray(item.ItemMayBeValue)
  }
  function string2value() {
    return (
      STR &&
      STR.split("").reduce((all, now, index) => {
        const n = Math.floor(index / 9)
        all[n] || (all[n] = [])
        all[n].push(Number(now))
        return all
      }, [])
    )
  }
  function merge() {
    SDK.map(e =>
      e.map(e => {
        if (e.ItemMayBeValue.length === 1) {
          e.ItemMayBeValue = e.ItemMayBeValue[0]
        }
      })
    )
    runBasic()
  }

  const STR =
    "810003290067000000900500006000408000604000809000209000700001008000000370053800042"

  const VALUE = string2value(STR) || [
    [2, 1, 6, 0, 8, 0, 9, 5, 7],
    [7, 8, 9, 0, 1, 0, 0, 0, 3],
    [5, 4, 0, 2, 9, 7, 0, 1, 6],
    [6, 7, 0, 0, 3, 5, 0, 9, 4],
    [4, 0, 8, 9, 6, 1, 7, 0, 5],
    [9, 5, 0, 0, 4, 2, 0, 6, 8],
    [1, 6, 0, 4, 2, 8, 0, 3, 9],
    [0, 9, 4, 0, 5, 0, 0, 0, 2],
    [3, 2, 5, 0, 7, 0, 4, 8, 1],
  ]

  const SDK = VALUE.map((e, H) =>
    e.map((value, L) => {
      const index = H * 9 + L
      const [A, a] = index2flex[index]
      return {
        ItemMayBeValue: value === 0 ? [...A9from1] : value,
        H,
        L,
        A,
        a,
        index,
      }
    })
  )

  const SDK_HANG = (window.SDK = SDK)
  const SDK_LIE = hang2lie(SDK_HANG)
  const SDK_AREA = hang2area(SDK_HANG)

  function basicRS(group) {
    const values = group.filter(isValue).map(e => e.ItemMayBeValue)
    const maybes = group.filter(isMaybe)
    return values.forEach(value =>
      maybes.forEach(maybe => {
        const index = maybe.ItemMayBeValue.indexOf(value)
        index != -1 && maybe.ItemMayBeValue.splice(index, 1)
      })
    )
  }
  function basicMB2(group) {
    const values = group.filter(isValue).map(e => e.ItemMayBeValue)
    const maybes = group.filter(isMaybe)
    maybes.forEach(maybe => {
      maybe.ItemMayBeValue = maybe.ItemMayBeValue.filter(
        e => !values.includes(e)
      )
    })
  }
  function basicMB(group) {
    const values = group.filter(isValue).map(e => e.ItemMayBeValue)
    const maybes = group.filter(isMaybe)
    maybes.forEach(maybe => {
      values.forEach(value => {
        const index = maybe.ItemMayBeValue.indexOf(value)
        index != -1 && maybe.ItemMayBeValue.splice(index, 1)
      })
    })
  }
  function basicRScache(group) {
    //分解模式
    const values = group.filter(isValue)
    const maybes = group.filter(isMaybe)
    return values.forEach(value => deleteArr(maybes, value))

    function deleteArr(maybes, target) {
      maybes.forEach(maybe => deleteTarget(maybe, target))
    }
    function deleteTarget(maybe, target) {
      const index = maybe.ItemMayBeValue.indexOf(target.ItemMayBeValue)
      index != -1 && maybe.ItemMayBeValue.splice(index, 1)
    }
  }

  window.test = function test() {
    const funcs = [
      () => A.forEach(basicRS),
      () => A.forEach(basicMB),
      () => A.forEach(basicMB2),
    ]
    const N = [...Array(11000)]
    const A = [...SDK_HANG, ...SDK_LIE, ...SDK_AREA]

    funcs.forEach(f => {
      console.time(f.name)
      N.forEach(f)
      console.timeEnd(f.name)
    })
  }
  window.test()
  document.onclick = test
  // window.test()
  // merge()
  // merge()
  console.timeEnd()
</script>
