<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
</html>
<script>
  // t/t2/t3的建立错误, 应该使用git分支管理
  console.clear()
  const A3 = [...Array(3).keys()]
  const A9 = [...Array(9).keys()]
  const A9from1 = [...A9].map(e => e + 1)

  const index2flex = A3.map(y =>
    A3.map(x => A3.map(l => A3.map(r => [l + y * 3, r + x * 3])))
  ).flat(3)

  function flex2index([squre, index]) {
    return index2flex.map(e => "" + e).findIndex(e => e === `${squre},${index}`)
  } //todo with MAP
  function hang2lie(row) {
    return A9.map(x => A9.map(y => row[y][x]))
  }
  function hang2area(hang) {
    const flat = hang.flat()
    return A9.map(squre =>
      A9.map(index => {
        const i = flex2index([squre, index])
        return flat[i]
      })
    )
  }
  function hasRS(item) {
    return !Array.isArray(item.ItemMayBeValue)
  }
  function needRS(item) {
    return Array.isArray(item.ItemMayBeValue)
  }
  function string2value() {
    return (
      STR &&
      STR.split("").reduce((all, now, index) => {
        const n = Math.floor(index / 9)
        all[n] || (all[n] = [])
        all[n].push(Number(now))
        return all
      }, [])
    )
  }
  function merge() {
    SDK.map(e =>
      e.map(e => {
        if (e.ItemMayBeValue.length === 1) {
          e.ItemMayBeValue = e.ItemMayBeValue[0]
        }
      })
    )
    runBasic()
  }

  const STR =
    "810003290067000000900500006000408000604000809000209000700001008000000370053800042"

  const VALUE = string2value(STR) || [
    [2, 1, 6, 0, 8, 0, 9, 5, 7],
    [7, 8, 9, 0, 1, 0, 0, 0, 3],
    [5, 4, 0, 2, 9, 7, 0, 1, 6],
    [6, 7, 0, 0, 3, 5, 0, 9, 4],
    [4, 0, 8, 9, 6, 1, 7, 0, 5],
    [9, 5, 0, 0, 4, 2, 0, 6, 8],
    [1, 6, 0, 4, 2, 8, 0, 3, 9],
    [0, 9, 4, 0, 5, 0, 0, 0, 2],
    [3, 2, 5, 0, 7, 0, 4, 8, 1],
  ]

  const SDK = (window.SDK = VALUE.map(e => e.map(value => ({ value }))))

  const SDK_HANG = SDK.ll
  const SDK_LIE = hang2lie(SDK_HANG)
  const SDK_AREA = hang2area(SDK_HANG)

  //填充上面生成的空壳,牛逼
  SDK.forEach((e, H) =>
    e.forEach((item, L) => {
      const value = item.value
      const index = H * 9 + L
      const [A, a] = index2flex[index]
      const items = [
        ...new Set([...SDK_HANG[H], ...SDK_LIE[L], ...SDK_AREA[A]]),
        // ...new Set([SDK_HANG[H], SDK_LIE[L], SDK_AREA[A]].flat()),
      ]
      Object.assign(item, {
        //另有一个本来的字段value
        ItemMayBeValue: value === 0 ? [...A9from1] : [],
        twoInOne: value === 0 ? [...A9from1] : value,
        H: [H, L],
        L: [L, H],
        A: [A, a],
        // H,
        // L,
        // A,
        // a,
        index,
        items,
      })
    })
  )
</script>
